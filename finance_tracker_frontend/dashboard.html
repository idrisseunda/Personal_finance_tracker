<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FINA-Personal Finance Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        body {
            background-image: url('background.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            min-height: 100vh;
            position: relative;
        }
        
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: 0;
        }
        
        .container {
            position: relative;
            z-index: 1;
        }
    </style>
</head>
<body>
    <script>
        // Check authentication FIRST - before anything else loads
        (function() {
            const user = localStorage.getItem('currentUser');
            const token = localStorage.getItem('token');
            if (!user || !token) {
                window.location.replace('index.html');
            }
        })();
    </script>

    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Header with Logout -->
        <header class="mb-8 bg-white rounded-xl shadow-lg p-6">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div class="flex items-center gap-4">
                    <img src="AIMS_logo.png" alt="AIMS Logo" class="h-16 w-16 object-contain">
                    <div>
                        <h1 class="text-4xl font-bold text-gray-800 mb-2">üí∞FINA-Personal Finance Tracker</h1>
                        <p class="text-gray-600">Track your income, expenses, savings, and investments</p>
                    </div>
                </div>
                <div class="text-right">
                    <p class="text-sm text-gray-600 mb-2">Welcome to FINA, <span id="userName" class="font-semibold text-gray-800"></span>!</p>
                    <button onclick="logout()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm transition-all">
                        Logout
                    </button>
                </div>
            </div>
        </header>

        <!-- Controls -->
        <div class="flex gap-4 mb-6 flex-wrap items-center">
            <button onclick="toggleAddForm()" class="bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white px-6 py-3 rounded-lg flex items-center gap-2 shadow-lg transition-all transform hover:scale-105">
                <span>‚ûï</span>
                Add Transaction
            </button>
            
            <div class="flex items-center gap-2 bg-white px-4 py-2 rounded-lg shadow-lg">
                <span>üîç</span>
                <select id="timeFilter" onchange="updateDashboard()" class="border-none bg-transparent focus:outline-none cursor-pointer font-medium text-gray-700">
                    <option value="daily">Daily</option>
                    <option value="weekly">Weekly</option>
                    <option value="monthly" selected>Monthly</option>
                    <option value="yearly">Yearly</option>
                </select>
            </div>
        </div>

        <!-- Add Transaction Form -->
        <div id="addForm" class="bg-white rounded-xl shadow-lg p-6 mb-8 hidden">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">Add New Transaction</h2>
            
            <form id="transactionForm"> <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Type</label>
                        <select id="transactionType" onchange="updateCategoryOptions()" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent bg-white">
                            <option value="income">Income</option>
                            <option value="expense" selected>Expense</option>
                            <option value="savings">Savings</option>
                            <option value="investment">Investment</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                        <select id="category" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent bg-white">
                            <option value="">Select...</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Amount</label>
                        <input type="number" id="amount" step="0.01" placeholder="0.00" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent bg-white">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Date</label>
                        <input type="date" id="date" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent bg-white">
                    </div>

                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                        <input type="text" id="description" placeholder="Optional description" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent bg-white">
                    </div>

                    <div class="md:col-span-2 flex gap-4">
                        <button type="button" onclick="addTransaction()" class="flex-1 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white py-3 rounded-lg font-medium transition-all transform hover:scale-105">
                            Add Transaction
                        </button>
                        <button type="button" onclick="toggleAddForm()" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 py-3 rounded-lg font-medium transition-all">
                            Cancel
                        </button>
                    </div>
                </div>
            </form> </div>

        <!-- Summary Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
            <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl shadow-2xl p-6 text-white transform hover:scale-105 transition-all">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm opacity-90">Total Income</span>
                    <span class="text-2xl">üìà</span>
                </div>
                <p id="totalIncome" class="text-3xl font-bold">$0.00</p>
            </div>

            <div class="bg-gradient-to-br from-red-500 to-red-600 rounded-xl shadow-2xl p-6 text-white transform hover:scale-105 transition-all">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm opacity-90">Total Expenses</span>
                    <span class="text-2xl">üìâ</span>
                </div>
                <p id="totalExpense" class="text-3xl font-bold">$0.00</p>
            </div>

            <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl shadow-2xl p-6 text-white transform hover:scale-105 transition-all">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm opacity-90">Savings</span>
                    <span class="text-2xl">üê∑</span>
                </div>
                <p id="totalSavings" class="text-3xl font-bold">$0.00</p>
            </div>

            <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl shadow-2xl p-6 text-white transform hover:scale-105 transition-all">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm opacity-90">Investments</span>
                    <span class="text-2xl">üí∞</span>
                </div>
                <p id="totalInvestment" class="text-3xl font-bold">$0.00</p>
            </div>

            <div id="balanceCard" class="bg-gradient-to-br from-teal-500 to-teal-600 rounded-xl shadow-2xl p-6 text-white transform hover:scale-105 transition-all">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm opacity-90">Balance</span>
                    <span class="text-2xl">üìÖ</span>
                </div>
                <p id="balance" class="text-3xl font-bold">$0.00</p>
            </div>
        </div>

        <!-- Charts -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <div class="bg-white rounded-xl shadow-2xl p-6">
                <h3 class="text-xl font-bold mb-4 text-gray-800">Income vs Expenses Trend</h3>
                <canvas id="trendChart"></canvas>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-lg">
                <h3 class="text-lg font-bold mb-4 text-gray-800">Income vs Expense (Bar Trend)</h3>
                <canvas id="trendBarChart" height="200"></canvas>
            </div>

            <div class="bg-white rounded-xl shadow-2xl p-6">
                <h3 class="text-xl font-bold mb-4 text-gray-800">Expenses by Category</h3>
                <canvas id="expensePieChart"></canvas>
            </div>

            <div class="bg-white rounded-xl shadow-2xl p-6">
                <h3 class="text-xl font-bold mb-4 text-gray-800">Income by Source</h3>
                <canvas id="incomeBarChart"></canvas>
            </div>

            <div class="bg-white rounded-xl shadow-2xl p-6">
                <h3 class="text-xl font-bold mb-4 text-gray-800">Expense Breakdown</h3>
                <canvas id="expenseBarChart"></canvas>
            </div>
        </div>

        <!-- Transaction History -->
        <div class="bg-white rounded-xl shadow-2xl p-6">
            <h3 class="text-xl font-bold mb-4 text-gray-800">Transaction History</h3>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b-2 border-gray-200">
                            <th class="text-left py-3 px-4">Date</th>
                            <th class="text-left py-3 px-4">Type</th>
                            <th class="text-left py-3 px-4">Category</th>
                            <th class="text-left py-3 px-4">Description</th>
                            <th class="text-right py-3 px-4">Amount</th>
                            <th class="text-center py-3 px-4">Action</th>
                        </tr>
                    </thead>
                    <tbody id="transactionTable">
                        <tr>
                            <td colspan="6" class="text-center py-8 text-gray-500">
                                No transactions found for this period
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>

        // Change this to true when you are ready to go online
        const isProduction = true; 

        // This automatically chooses the right URL based on the 'isProduction' switch
        const API_BASE_URL = isProduction 
            ? "https://personal-finance-tracker-3-dcqd.onrender.com" // Update this later
            : "http://127.0.0.1:5000";
                // Get current user and display name
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        document.getElementById('userName').textContent = currentUser.name;

        // Logout function
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('currentUser');
                window.location.replace('index.html');
            }
        }

        // Data structures - Separate transactions per user
        let transactions = [];
        const expenseCategories = ['Food', 'Transportation', 'Health', 'Academics', 'Household', 'Helps', 'Others'];
        const incomeCategories = ['Gift', 'Salary', 'Return on Investment', 'Others'];
        
        let charts = {
            trend: null,
            expensePie: null,
            incomeBar: null,
            expenseBar: null
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadTransactions();
            updateCategoryOptions();
            document.getElementById('date').valueAsDate = new Date();
            updateDashboard();
        });

        // Load transactions for current user
        async function loadTransactions() {
            const token = localStorage.getItem('token');
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/transactions`, {
                    method: 'GET',
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const data = await response.json();
                if (response.ok) {
                    transactions = data.transactions; // Use the data from backend
                    updateDashboard(); // Call your existing function to update UI
                }
            } catch (error) {
                console.error("Failed to load transactions", error);
            }
        }

        // Save transactions for current user
        function saveTransactions() {
            const userKey = 'transactions_' + currentUser.id;
            localStorage.setItem(userKey, JSON.stringify(transactions));
        }

        function toggleAddForm() {
            const form = document.getElementById('addForm');
            form.classList.toggle('hidden');
        }

        function updateCategoryOptions() {
            const type = document.getElementById('transactionType').value;
            const categorySelect = document.getElementById('category');
            categorySelect.innerHTML = '<option value="">Select...</option>';
            
            let categories = [];
            if (type === 'income') {
                categories = incomeCategories;
            } else if (type === 'expense') {
                categories = expenseCategories;
            } else {
                categories = [type.charAt(0).toUpperCase() + type.slice(1)];
            }
            
            categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                categorySelect.appendChild(option);
            });
        }

        // 1. UPDATE the function header to include 'async'
        async function addTransaction() {
            const token = localStorage.getItem('token');
            
            const transactionData = {
                type: document.getElementById('transactionType').value,
                category: document.getElementById('category').value,
                amount: parseFloat(document.getElementById('amount').value),
                date: document.getElementById('date').value,
                description: document.getElementById('description').value
            };

            try {
                const response = await fetch(`${API_BASE_URL}/api/transactions`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}` 
                    },
                    body: JSON.stringify(transactionData)
                });

                if (response.ok) {
                    // ISSUE 1 FIX: Clear the form fields
                    document.getElementById('transactionForm').reset(); 

                    // ISSUE 2 FIX: Hide the form and REFRESH the list immediately
                    toggleAddForm(); 
                    await loadTransactions(); // This pulls the new data from the DB
                    
                    console.log("UI Updated successfully");
                } else {
                    alert("Failed to add transaction");
                }
            
            } catch (error) {
                console.error("Network/Connection Error:", error);
            }
        }

        function filterTransactionsByTime() {
            const filter = document.getElementById('timeFilter').value;
            const now = new Date();
            // Today at midnight for clean comparison
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            
            return transactions.filter(t => {
                const transDate = new Date(t.date);
                const tDate = new Date(transDate.getFullYear(), transDate.getMonth(), transDate.getDate());
                
                switch(filter) {
                    case 'daily':
                        return tDate.getTime() === today.getTime();

                    case 'weekly':
                        // 1. Find the current Monday
                        const day = today.getDay(); // 0 is Sun, 1 is Mon...
                        const diffToMonday = today.getDate() - day + (day === 0 ? -6 : 1);
                        const monday = new Date(now.getFullYear(), now.getMonth(), diffToMonday);
                        monday.setHours(0,0,0,0);

                        // 2. Find the current Sunday (Monday + 6 days)
                        const sunday = new Date(monday);
                        sunday.setDate(monday.getDate() + 6);
                        sunday.setHours(23,59,59,999);

                        // Only return if it's BETWEEN this Monday and this Sunday
                        return tDate >= monday && tDate <= sunday;

                    case 'monthly':
                        return transDate.getMonth() === now.getMonth() && 
                            transDate.getFullYear() === now.getFullYear();

                    case 'yearly':
                        return transDate.getFullYear() === now.getFullYear();

                    case 'custom':
                        const selected = document.getElementById('customDatePicker').value;
                        if (!selected) return true; // Show all if no date picked yet
                        return transDate.toISOString().split('T')[0] === selected;

                    default:
                        return true;
                }
            });
        }

        function updateDashboard() {
            const filtered = filterTransactionsByTime();
            
            const totalIncome = filtered.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const totalExpense = filtered.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const totalSavings = filtered.filter(t => t.type === 'savings').reduce((sum, t) => sum + t.amount, 0);
            const totalInvestment = filtered.filter(t => t.type === 'investment').reduce((sum, t) => sum + t.amount, 0);
            const balance = totalIncome - totalExpense - totalSavings - totalInvestment;

            document.getElementById('totalIncome').textContent = 'F' + totalIncome.toFixed(2);
            document.getElementById('totalExpense').textContent = 'F' + totalExpense.toFixed(2);
            document.getElementById('totalSavings').textContent = 'F' + totalSavings.toFixed(2);
            document.getElementById('totalInvestment').textContent = 'F' + totalInvestment.toFixed(2);
            document.getElementById('balance').textContent = 'F' + balance.toFixed(2);
            
            const balanceCard = document.getElementById('balanceCard');
            if (balance >= 0) {
                balanceCard.className = 'bg-gradient-to-br from-teal-500 to-teal-600 rounded-xl shadow-2xl p-6 text-white transform hover:scale-105 transition-all';
            } else {
                balanceCard.className = 'bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl shadow-2xl p-6 text-white transform hover:scale-105 transition-all';
            }

            updateTransactionTable(filtered);
            updateCharts(filtered);
        }

        function updateTransactionTable(filtered) {
            const tbody = document.getElementById('transactionTable');
            
            if (filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="text-center py-8 text-gray-500">No transactions found for this period</td></tr>';
                return;
            }

            tbody.innerHTML = filtered.map(t => {
                const badgeClass = t.type === 'income' ? 'bg-green-100 text-green-800' :
                                   t.type === 'expense' ? 'bg-red-100 text-red-800' :
                                   t.type === 'savings' ? 'bg-blue-100 text-blue-800' :
                                   'bg-purple-100 text-purple-800';
                
                return `
                    <tr class="border-b border-gray-100 hover:bg-gray-50">
                        <td class="py-3 px-4">${new Date(t.date).toLocaleDateString()}</td>
                        <td class="py-3 px-4">
                            <span class="px-3 py-1 rounded-full text-sm font-medium ${badgeClass}">
                                ${t.type}
                            </span>
                        </td>
                        <td class="py-3 px-4">${t.category}</td>
                        <td class="py-3 px-4 text-gray-600">${t.description || '-'}</td>
                        <td class="py-3 px-4 text-right font-semibold">F${t.amount.toFixed(2)}</td>
                        <td class="py-3 px-4 text-center">
                            <button onclick="deleteTransaction(${t.id})" class="text-red-600 hover:text-red-800 font-medium">
                                Delete
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function updateCharts(filtered) {
            updateTrendChart(filtered);
            updateTrendBarChart(filtered);
            updateExpensePieChart(filtered);
            updateIncomeBarChart(filtered);
            updateExpenseBarChart(filtered);
        }

        function updateTrendChart(filtered) {
            const data = {};
            filtered.forEach(t => {
                // Use the raw date string for the key to ensure grouping works
                const dateKey = t.date; 
                if (!data[dateKey]) {
                    data[dateKey] = { income: 0, expense: 0 };
                }
                if (t.type === 'income') data[dateKey].income += t.amount;
                if (t.type === 'expense') data[dateKey].expense += t.amount;
            });

            // 1. Convert to array and SORT chronologically (oldest to newest)
            const chartData = Object.entries(data)
                .sort((a, b) => new Date(a[0]) - new Date(b[0])) // NEW: Chronological sort
                .slice(-10) // Take the 10 most recent dates
                .map(([date, values]) => ({
                    date: new Date(date).toLocaleDateString(), // Format for display
                    ...values
                }));

            if (charts.trend) charts.trend.destroy();
            
            const ctx = document.getElementById('trendChart');
            charts.trend = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: chartData.map(d => d.date), // These will now be in order
                    datasets: [
                        {
                            label: 'Income',
                            data: chartData.map(d => d.income),
                            borderColor: '#10B981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'Expense',
                            data: chartData.map(d => d.expense),
                            borderColor: '#EF4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Time ‚Üí'
                            }
                        }
                    }
                }
            });
        }

        function updateTrendBarChart(filtered) {
            const data = {};
            filtered.forEach(t => {
                if (!data[t.date]) data[t.date] = { income: 0, expense: 0 };
                if (t.type === 'income') data[t.date].income += t.amount;
                if (t.type === 'expense') data[t.date].expense += t.amount;
            });

            // Sort and slice the last 10 dates for readability
            const chartData = Object.entries(data)
                .sort((a, b) => new Date(a[0]) - new Date(b[0]))
                .slice(-10)
                .map(([date, values]) => ({ 
                    date: new Date(date).toLocaleDateString(undefined, {month: 'short', day: 'numeric'}), 
                    ...values 
                }));

            if (charts.trendBar) charts.trendBar.destroy();
            
            const ctx = document.getElementById('trendBarChart');
            charts.trendBar = new Chart(ctx, {
                type: 'bar', // Changed to bar
                data: {
                    labels: chartData.map(d => d.date),
                    datasets: [
                        {
                            label: 'Income',
                            data: chartData.map(d => d.income),
                            backgroundColor: '#10B981', // Green
                            borderRadius: 4
                        },
                        {
                            label: 'Expense',
                            data: chartData.map(d => d.expense),
                            backgroundColor: '#EF4444', // Red
                            borderRadius: 4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { position: 'top' }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }

        function updateExpensePieChart(filtered) {
            const expenseData = expenseCategories.map(cat => ({
                name: cat,
                value: filtered.filter(t => t.type === 'expense' && t.category === cat)
                               .reduce((sum, t) => sum + t.amount, 0)
            })).filter(item => item.value > 0);

            if (charts.expensePie) charts.expensePie.destroy();
            
            const ctx = document.getElementById('expensePieChart');
            charts.expensePie = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: expenseData.map(d => d.name),
                    datasets: [{
                        data: expenseData.map(d => d.value),
                        backgroundColor: ['#0088FE', '#00C49F', '#FFBB28', '#FF8042', '#8884D8', '#82CA9D', '#FFC658']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'right',
                        }
                    }
                }
            });
        }

        function updateIncomeBarChart(filtered) {
            const incomeData = incomeCategories.map(cat => ({
                name: cat,
                value: filtered.filter(t => t.type === 'income' && t.category === cat)
                               .reduce((sum, t) => sum + t.amount, 0)
            })).filter(item => item.value > 0);

            if (charts.incomeBar) charts.incomeBar.destroy();
            
            const ctx = document.getElementById('incomeBarChart');
            charts.incomeBar = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: incomeData.map(d => d.name),
                    datasets: [{
                        label: 'Amount',
                        data: incomeData.map(d => d.value),
                        backgroundColor: '#10B981'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function updateExpenseBarChart(filtered) {
            const expenseData = expenseCategories.map(cat => ({
                name: cat,
                value: filtered.filter(t => t.type === 'expense' && t.category === cat)
                               .reduce((sum, t) => sum + t.amount, 0)
            })).filter(item => item.value > 0);

            if (charts.expenseBar) charts.expenseBar.destroy();
            
            const ctx = document.getElementById('expenseBarChart');
            charts.expenseBar = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: expenseData.map(d => d.name),
                    datasets: [{
                        label: 'Amount',
                        data: expenseData.map(d => d.value),
                        backgroundColor: '#EF4444'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
        async function deleteTransaction(id) {
            if (!confirm("Are you sure you want to delete this transaction?")) return;

            const token = localStorage.getItem('token');
            try {
                const response = await fetch(`${API_BASE_URL}/api/transactions/${id}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    // This reloads the data so the charts and table update immediately
                    await loadTransactions();
                } else {
                    alert("Delete failed. Please try again.");
                }
            } catch (error) {
                console.error("Delete error:", error);
            }
        }
    </script>
</body>
</html>
